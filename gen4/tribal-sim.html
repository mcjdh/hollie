<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Tribal Simulation</title>
<style>
  body {
    margin:0;
    background:#000;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    overflow:hidden;
  }
  canvas {
    image-rendering: pixelated;
    width:512px;
    height:512px;
  }
</style>
</head>
<body>
<canvas id="world" width="64" height="64"></canvas>
<script>
// Simple seeded RNG (Mulberry32)
function RNG(seed){
  this.seed=seed>>>0;
}
RNG.prototype.next=function(){
  let t=this.seed+=0x6D2B79F5;
  t=Math.imul(t ^ t>>>15, t | 1);
  t^= t + Math.imul(t ^ t>>>7, t | 61);
  return ((t ^ t>>>14)>>>0)/4294967296;
};

const TILE_EMPTY=0;
const TILE_WALL=1;
const TILE_FOOD=2;

const COLORS=['#111','#555','#0f0'];

const SIZE=64;
let rng=new RNG(Date.now());
let world=[];
let agents=[];

function generateWorld(seed){
  rng=new RNG(seed);
  world=new Array(SIZE);
  for(let y=0;y<SIZE;y++){
    world[y]=new Array(SIZE);
    for(let x=0;x<SIZE;x++){
      world[y][x]=rng.next()<0.1?TILE_WALL:TILE_EMPTY;
    }
  }
  // scatter food
  for(let i=0;i<200;i++){
    const x=Math.floor(rng.next()*SIZE);
    const y=Math.floor(rng.next()*SIZE);
    if(world[y][x]===TILE_EMPTY) world[y][x]=TILE_FOOD;
  }
}

function addAgents(count){
  agents=[];
  for(let i=0;i<count;i++){
    let placed=false;
    while(!placed){
      const x=Math.floor(rng.next()*SIZE);
      const y=Math.floor(rng.next()*SIZE);
      if(world[y][x]===TILE_EMPTY){
        agents.push({x,y,tribe:i%2,energy:20,brain:newBrain()});
        placed=true;
      }
    }
  }
}

function newBrain(){
  // simple 5x4 weight matrix producing 4 movement outputs
  return {w:new Array(5).fill(0).map(()=>rng.next()*2-1)};
}

function stepAgent(a){
  const surroundings=[
    tileAt(a.x,a.y-1),
    tileAt(a.x+1,a.y),
    tileAt(a.x,a.y+1),
    tileAt(a.x-1,a.y),
    1 // bias
  ];
  let maxVal=-Infinity, dir=0;
  for(let i=0;i<4;i++){
    const val=a.brain.w[i]*surroundings[i]+a.brain.w[4]*surroundings[4];
    if(val>maxVal){maxVal=val;dir=i;}
  }
  moveAgent(a,dir);
}

function tileAt(x,y){
  if(x<0||y<0||x>=SIZE||y>=SIZE) return TILE_WALL;
  return world[y][x];
}

function moveAgent(a,dir){
  let nx=a.x,ny=a.y;
  if(dir===0)ny--; if(dir===1)nx++; if(dir===2)ny++; if(dir===3)nx--;
  if(tileAt(nx,ny)===TILE_WALL) return;
  if(tileAt(nx,ny)===TILE_FOOD){
    a.energy+=10;
    world[ny][nx]=TILE_EMPTY;
  }
  a.x=nx; a.y=ny; a.energy--;
}

function update(){
  for(const a of agents){
    if(a.energy>0) stepAgent(a);
  }
}

function render(){
  const ctx=document.getElementById('world').getContext('2d');
  const img=ctx.createImageData(SIZE,SIZE);
  for(let y=0;y<SIZE;y++){
    for(let x=0;x<SIZE;x++){
      const idx=(y*SIZE+x)*4;
      const color=hexToRgb(COLORS[world[y][x]]);
      img.data[idx]=color.r;
      img.data[idx+1]=color.g;
      img.data[idx+2]=color.b;
      img.data[idx+3]=255;
    }
  }
  for(const a of agents){
    const idx=(a.y*SIZE+a.x)*4;
    const c=a.tribe===0?{r:200,g:50,b:50}:{r:50,g:50,b:200};
    img.data[idx]=c.r;
    img.data[idx+1]=c.g;
    img.data[idx+2]=c.b;
  }
  ctx.putImageData(img,0,0);
}

function hexToRgb(h){
  const r=parseInt(h.substr(1,2),16);
  const g=parseInt(h.substr(3,2),16);
  const b=parseInt(h.substr(5,2),16);
  return {r,g,b};
}

function loop(){
  update();
  render();
  requestAnimationFrame(loop);
}

generateWorld(Date.now());
addAgents(10);
loop();
</script>
</body>
</html>
