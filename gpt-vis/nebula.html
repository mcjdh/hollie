<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Nebula Visualization</title>
    <style>
        body {
            margin:0;
            overflow:hidden;
            background:black;
        }
        #canvas {
            display:block;
        }
        .info {
            position:fixed;
            top:10px;
            left:10px;
            color:#f0f;
            font-family:'Courier New', monospace;
            background:rgba(0,0,0,0.5);
            padding:5px 10px;
            border-radius:5px;
            font-size:14px;
        }
    </style>
</head>
<body>
    <div class="info">Nebula &mdash; press ESC to close</div>
    <canvas id="canvas"></canvas>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let width, height;
        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        const particles = [];
        const count = 300;
        for (let i=0;i<count;i++) {
            particles.push({
                x: Math.random()*width,
                y: Math.random()*height,
                vx: (Math.random()-0.5)*0.5,
                vy: (Math.random()-0.5)*0.5,
                size: Math.random()*2+1,
                hue: Math.random()*360
            });
        }

        function update() {
            for (const p of particles) {
                p.x += p.vx;
                p.y += p.vy;
                if (p.x < 0) p.x = width;
                if (p.x > width) p.x = 0;
                if (p.y < 0) p.y = height;
                if (p.y > height) p.y = 0;
            }
        }

        function render() {
            ctx.globalCompositeOperation = 'source-over';
            ctx.fillStyle = 'rgba(0,0,0,0.1)';
            ctx.fillRect(0,0,width,height);
            ctx.globalCompositeOperation = 'lighter';
            for (const p of particles) {
                ctx.fillStyle = `hsla(${p.hue},100%,60%,0.2)`;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI*2);
                ctx.fill();
            }
        }

        function loop() {
            update();
            render();
            requestAnimationFrame(loop);
        }
        loop();

        document.addEventListener('keydown', e => {
            if (e.key === 'Escape') {
                window.parent.postMessage('close', '*');
            }
        });
    </script>
</body>
</html>
